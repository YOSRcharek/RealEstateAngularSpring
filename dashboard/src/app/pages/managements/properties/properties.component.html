<div class="app-add-user">
  <a mat-button class="all-access-pass-btn text-dark p-x-16" (click)="openAddDialog()">
    <div class="d-flex align-items-center gap-8 f-s-16 f-w-400">
      <i class="iconify icon-18 d-flex" data-icon="mdi:plus"></i>
      Add Property
    </div>
  </a>
</div>

<mat-card class="cardWithShadow">
  <mat-card-content>
    <mat-card-title>Properties</mat-card-title>
<div *ngIf="noPropertyMessage" class="text-center text-gray-500 p-4">
  {{ noPropertyMessage }}
</div>

    <div class="table-responsive">
      <table mat-table [dataSource]="annonces" class="w-100">

        <!-- Photo -->
        <ng-container matColumnDef="photo">
          <th mat-header-cell *matHeaderCellDef>Picture</th>
          <td mat-cell *matCellDef="let annonce">
            <img 
              class="lazyload card-img"
              [src]="getFirstImage(annonce)" 
              alt="image-annonce"
              width="80"
              height="60">
          </td>
        </ng-container>

        <!-- Nom -->
        <ng-container matColumnDef="nom">
          <th mat-header-cell *matHeaderCellDef>Name</th>
          <td mat-cell *matCellDef="let annonce">{{ annonce.titre }}</td>
        </ng-container>

        <!-- Prix -->
        <ng-container matColumnDef="prix">
          <th mat-header-cell *matHeaderCellDef>Price</th>
          <td mat-cell *matCellDef="let annonce">
            {{ annonce.prix | currency:'TND':'symbol':'1.0-0' }}
          </td>
        </ng-container>

     
        <ng-container matColumnDef="statut">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let annonce">
            <span
              class="rounded f-w-600 p-6 p-y-4 f-s-12"
              [ngClass]="{
                'bg-light-success text-success':annonce.statut === 'RENT',
                'bg-light-error text-error': annonce.statut === 'SALE'
              }"
            >
                   {{ annonce.statut }}
            </span>
          </td>
        </ng-container>

        <!-- Adresse -->
        <ng-container matColumnDef="adresse">
          <th mat-header-cell *matHeaderCellDef>Address</th>
          <td mat-cell *matCellDef="let annonce">{{ annonce.adresse }}</td>
        </ng-container>

        <!-- Date Creation -->
        <ng-container matColumnDef="dateCreation">
          <th mat-header-cell *matHeaderCellDef>Date Created</th>
          <td mat-cell *matCellDef="let annonce">{{ annonce.dateCreation | date:'medium' }}</td>
        </ng-container>

        <!-- Type -->
        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef>Type</th>
          <td mat-cell *matCellDef="let annonce">
            <span
              class="rounded f-w-600 p-6 p-y-4 f-s-12"
              [ngClass]="{
                'bg-light-success text-success': annonce.typeBien === 'MAISON',
                'bg-light-warning text-warning': annonce.typeBien === 'APPARTEMENT',
                'bg-light-error text-error': annonce.typeBien === 'LAND'

              }"
            >
              {{ getTypeBienLabel(annonce.typeBien) }}
            </span>
          </td>
        </ng-container>

        <!-- Actions -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let annonce">
            <button mat-icon-button [matMenuTriggerFor]="menu">
              <mat-icon>more_vert</mat-icon>
            </button>
            
          
            <mat-menu #menu="matMenu">
                 <button mat-menu-item (click)="openDetailDialog(annonce)">
              <mat-icon>info</mat-icon>
              <span>Details</span>
            </button>
              <button mat-menu-item (click)="openEditDialog(annonce)">
                <mat-icon>edit</mat-icon>
                <span>Edit</span>
              </button>
              <button mat-menu-item (click)="openConfirmDialog(annonce.id)">
                <mat-icon>delete</mat-icon>
                <span>Delete</span>
              </button>
            </mat-menu>
          </td>
        </ng-container>

        <!-- Header & Rows -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns" ></tr>
      </table>
    </div>
  </mat-card-content>

</mat-card>
